

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1   Introduction &mdash; openrtm_tutorial 0.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="openrtm_tutorial 0.4 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="top.html">openrtm_tutorial 0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p><a class="reference external" href="2.1_samplewordlogger.html">Logger RTC that Saves the Voice-recognized Time-stamped Keywords</a></p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#introduction" id="id14">1&nbsp;&nbsp;&nbsp;Introduction</a><ul class="auto-toc">
<li><a class="reference internal" href="#id1" id="id15">1.1&nbsp;&nbsp;&nbsp;What you&#8217;ll experience</a></li>
<li><a class="reference internal" href="#id2" id="id16">1.2&nbsp;&nbsp;&nbsp;Related Tutorials</a></li>
<li><a class="reference internal" href="#systemenvironment" id="id17">1.3&nbsp;&nbsp;&nbsp;SystemEnvironment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rtc-i-o-configuration" id="id18">2&nbsp;&nbsp;&nbsp;RTC spec (I/O, Configuration)</a></li>
<li><a class="reference internal" href="#rtcbuilder" id="id19">3&nbsp;&nbsp;&nbsp;Install RTCBuilder</a></li>
<li><a class="reference internal" href="#how-to-make-rtc" id="id20">4&nbsp;&nbsp;&nbsp;How to make RTC</a><ul class="auto-toc">
<li><a class="reference internal" href="#id3" id="id21">4.1&nbsp;&nbsp;&nbsp;Create New Project</a></li>
<li><a class="reference internal" href="#samplewordlogger" id="id22">4.2&nbsp;&nbsp;&nbsp;Generate SampleWordLogger RTC template</a><ul class="auto-toc">
<li><a class="reference internal" href="#id4" id="id23">4.2.1&nbsp;&nbsp;&nbsp;Input profile info and generate code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5" id="id24">4.3&nbsp;&nbsp;&nbsp;Build tentatively</a></li>
<li><a class="reference internal" href="#id6" id="id25">4.4&nbsp;&nbsp;&nbsp;Edit header, source files</a><ul class="auto-toc">
<li><a class="reference internal" href="#id7" id="id26">4.4.1&nbsp;&nbsp;&nbsp;Implement Activity</a></li>
<li><a class="reference internal" href="#cpp" id="id27">4.4.2&nbsp;&nbsp;&nbsp;Edit .cpp file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cmakelist-txt" id="id28">4.5&nbsp;&nbsp;&nbsp;Edit CMakeLists.txt</a></li>
<li><a class="reference internal" href="#vc" id="id29">4.6&nbsp;&nbsp;&nbsp;Build by VC++</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8" id="id30">5&nbsp;&nbsp;&nbsp;HowToRun</a></li>
</ul>
</div>
<script src="../../batcall.js"></script><div class="section" id="introduction">
<h1><a class="toc-backref" href="#id14">1&nbsp;&nbsp;&nbsp;Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id15">1.1&nbsp;&nbsp;&nbsp;What you&#8217;ll experience</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a href="#id1"><span class="problematic" id="id2">`</span></a>Develop a Logger RTC that connects an RTC in <a href="#id3"><span class="problematic" id="id4">`</span></a>OpenHRI`and saves the voice-recognized, timestamped Keywords.</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id16">1.2&nbsp;&nbsp;&nbsp;Related Tutorials</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>General detailed instruction on making <cite>RTC</cite> is available (in Japanese though) in <cite>SampleWordLogger</cite> RTC tutorial[<a class="reference internal" href="#id9">1</a>], where especially the usage of graphical tool on <cite>Eclipse</cite> is included.</li>
</ul>
</div>
<div class="section" id="systemenvironment">
<h2><a class="toc-backref" href="#id17">1.3&nbsp;&nbsp;&nbsp;SystemEnvironment</a><a class="headerlink" href="#systemenvironment" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Windows 7 / 8</li>
<li>Visual C++ 2010 (English [<a class="reference external" href="http://www.visualstudio.com/downloads/download-visual-studio-vs#DownloadFamilies_4">3</a>], Japanese [<a class="reference external" href="http://go.microsoft.com/fwlink/?LinkId=190491&amp;clcid=0x411">4</a>])</li>
<li><cite>CMake</cite> 2.8 (its installer is bundled in ./misc/installer/cmake-2.8.8-win32-x86.exe)</li>
<li><cite>RTCBuilder</cite> 1.1 (bundled in Eclipse [<a class="reference external" href="http://openrtp.jp/wiki/attachments/_default/Home/iRex2011/eclipse342_rtmtools110-rc2_win32_ja.zip/download">5</a>])</li>
</ul>
</div>
</div>
<div class="section" id="rtc-i-o-configuration">
<h1><a class="toc-backref" href="#id18">2&nbsp;&nbsp;&nbsp;RTC spec (I/O, Configuration)</a><a class="headerlink" href="#rtc-i-o-configuration" title="Permalink to this headline">¶</a></h1>
<p>Let&#8217;s call the RT component we&#8217;re about to create &#8220;SampleWordLogger RTC&#8221;.</p>
<p>This RTC has an <cite>InPort</cite> (input port) of <cite>TimedString</cite> data type. We only want to save the log into a file and thus the RTC does not have output port (<cite>OutPort</cite>), and name <cite>InPort</cite> as <cite>result</cite>.</p>
<p>This time we embed the log file path in the source (you can modify it if you want).</p>
<p>Summarizing the RTC spec into the table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Component Name</th>
<th class="head">SampleWordLogger</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td colspan="2">InPort</td>
</tr>
<tr class="row-odd"><td>Port Name</td>
<td>result</td>
</tr>
<tr class="row-even"><td>Data Type</td>
<td>TimedString</td>
</tr>
<tr class="row-odd"><td colspan="2">OutPort</td>
</tr>
<tr class="row-even"><td>Port Name</td>
<td>(None)</td>
</tr>
<tr class="row-odd"><td>Data Type</td>
<td>(None)</td>
</tr>
<tr class="row-even"><td colspan="2">Configuration</td>
</tr>
<tr class="row-odd"><td>Parameter Name</td>
<td>(None)</td>
</tr>
<tr class="row-even"><td>Data Type</td>
<td>(None)</td>
</tr>
<tr class="row-odd"><td>Values</td>
<td>(None)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rtcbuilder">
<h1><a class="toc-backref" href="#id19">3&nbsp;&nbsp;&nbsp;Install RTCBuilder</a><a class="headerlink" href="#rtcbuilder" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we&#8217;ll use <cite>RTBuilder</cite>, an  <cite>Eclipse</cite>-based tool that&#8217;s bundled in <cite>OpenRTP (Open RT Platform)</cite>. So download and install it from here[<a class="reference internal" href="#id10">2</a>].</p>
<p>Run <cite>Eclipse</cite> with workspace set, you&#8217;ll see a welcome page like below (<a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/1028/fig1-1EclipseInit.png">image source</a>)．</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/1028/fig1-1EclipseInit.png" src="http://www.openrtm.org/openrtm/sites/default/files/1028/fig1-1EclipseInit.png" />
<p>Since we don&#8217;t need a welcome page, click &#8220;x&#8221; button at the left top to close (<a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/1028/fig2-2PerspectiveSwitch.png">image source</a>)．</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/1028/fig2-2PerspectiveSwitch.png" src="http://www.openrtm.org/openrtm/sites/default/files/1028/fig2-2PerspectiveSwitch.png" />
<p>Push &#8220;Open Perspective&#8221; button at the right top, then click &#8220;Other...&#8221; in the pulldown(<a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/208/fig2-3PerspectiveSelection.png">image source</a>)．</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/208/fig2-3PerspectiveSelection.png" src="http://www.openrtm.org/openrtm/sites/default/files/208/fig2-3PerspectiveSelection.png" />
<p>Choose <cite>RTC Builder</cite>.</p>
</div>
<div class="section" id="how-to-make-rtc">
<h1><a class="toc-backref" href="#id20">4&nbsp;&nbsp;&nbsp;How to make RTC</a><a class="headerlink" href="#how-to-make-rtc" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id21">4.1&nbsp;&nbsp;&nbsp;Create New Project</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>We need to create a new <cite>Eclipse</cite> project on <cite>RTCBuilder</cite> in order to make <cite>SampleWordLogger</cite> RTC. Choose from menu at the top [File]-[New]-[Project].</p>
<img alt="_images/rtb_new_prj.png" src="_images/rtb_new_prj.png" />
<p>In &#8220;New Project&#8221; window, ｢New｣-｢RTC Builder｣ then ｢Next｣. In ｢Project Name｣ field, type in <cite>SampleWordLogger</cite> then ｢Finish｣.</p>
<img alt="_images/rtb_new_prj_name.png" src="_images/rtb_new_prj_name.png" />
<p>The project is now generated and added to <cite>Eclipse&#8217; Package Explorer</cite>. You&#8217;ll see in the new project that RTC.xml, an <cite>RTC profile</cite> that contains default values, is automatically generated.</p>
<img alt="_images/rtb_wordlogger_created.png" src="_images/rtb_wordlogger_created.png" />
<p>At the time of <cite>RTC.xml</cite> being generated, the <cite>RTCBuilder</cite> editor that&#8217;s associated with the projecshould open. If not, open it manually from toolbar ｢Open New RtcBuilder Editor｣, or on menu bar [file]-[Open New Builder Editor].</p>
<img alt="_images/rtb_button_open_rtbeditor.png" src="_images/rtb_button_open_rtbeditor.png" />
<p>(<a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/1028/fig2-10FileMenuOpenNewBuilder.png">image source</a>)．</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/1028/fig2-10FileMenuOpenNewBuilder.png" src="http://www.openrtm.org/openrtm/sites/default/files/1028/fig2-10FileMenuOpenNewBuilder.png" />
</div>
<div class="section" id="samplewordlogger">
<h2><a class="toc-backref" href="#id22">4.2&nbsp;&nbsp;&nbsp;Generate SampleWordLogger RTC template</a><a class="headerlink" href="#samplewordlogger" title="Permalink to this headline">¶</a></h2>
<p>To generate the template of <cite>SampleWordLogger RTC</cite>, use <cite>RTCBuilder</cite>.</p>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id23">4.2.1&nbsp;&nbsp;&nbsp;Input profile info and generate code</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>First, open the tab 「Basic」 at the far left and fill in description, version number in addition to RTC name. Labels in red are required (others can be default values).</p>
<img alt="_images/rtb_logger_componentinfo.png" src="_images/rtb_logger_componentinfo.png" />
<p>Then choose the action callback in the tab 「Activity」. In <cite>SampleWordLogger RTC</cite>, we use <cite>onActivated()</cite>, <cite>onDeactivated()</cite>, and <cite>onExecute()</cite> callbacks. As the image below, (1) check <cite>onAtivated</cite>, then select &#8220;on&#8221; in the radio button (2). Do so too for onDeactivated, onExecute (<a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/1431/Activity.png">image source</a>).</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/1431/Activity.png" src="http://www.openrtm.org/openrtm/sites/default/files/1431/Activity.png" />
<p>Select &#8220;Data Ports&#8221; tab and input data port info as we defined earlier. You can leave variable name, location.</p>
<img alt="_images/rtb_logger_dataport.png" src="_images/rtb_logger_dataport.png" />
<p>Next go to tab 「Language and Environment」 to choose programming language. Here choose <cite>C++</cite>. Note that in this tab no default values are set, and errors occur if you don&#8217;t set anything. So be sure to work on.</p>
<p>Also, when using <cite>C++</cite> you are to build with <cite>CMake</cite>. However, if you prefer to using an older <cite>VC</cite> <cite>project</cite>, or to generating a <cite>solution</cite> directly by <cite>RTCBuilder</cite>, check <cite>Use old build environment</cite>.</p>
<p>At last, in the tab 「Basic」 click &#8220;Code Generatioin&#8221; to generate the template of your RTC.</p>
<p>NOTE; codes are generated into the folder in the workspace you specified when <cite>Eclipse</cite> launched. You can check it by 「File(F)」 &gt; 「Workspace(W)...」.</p>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id24">4.3&nbsp;&nbsp;&nbsp;Build tentatively</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Well, you&#8217;ve generated kind-of skeletal source code of <cite>SampleWordLogger RTC</cite> so far. Nothing will be output even when you connect anything to the <cite>InPort</cite> of your <cite>RTC</cite>, but you can build it.</p>
<p>NOTE; With an RTC that has <cite>service port</cite> and <cite>provider</cite>, build might not pass without concrete code.</p>
<p>Ok, then do <cite>Configure</cite> the build environment by using <cite>CMake</cite>. Suppose on Linux, in the directory where the source of SampleWordLogger was generated:</p>
<div class="highlight-python"><pre>$ cmake .
$ make</pre>
</div>
<p>at this point, <cite>Configure</cite> and <cite>build</cite> should be done. On <cite>Windows</cite>, we use GUI tool to run <cite>Configure</cite>. From <cite>Start</cite> menu or else on Windows, run <a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/4625/CMakeGUI0.png">CMake (cmake-gui)`(`image source</a>)．</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/4625/CMakeGUI0.png" src="http://www.openrtm.org/openrtm/sites/default/files/4625/CMakeGUI0.png" />
<p>On upper side you&#8217;ll find a text box like below. Specify each location (where <cite>CMakeList.txt</cite> is located at, build directory).</p>
<blockquote>
<div>Where is the soruce code ^ Where to build the binaries</div></blockquote>
<p>Source location is where the source code of <cite>SampleWordLogger RTC</cite> is generated into and where <cite>CMakeList.txt</cite> resides. It&#8217;s <cite>&lt;%WORKSPACE%&gt;/SampleWordLogger</cite> by default.</p>
<p><cite>Build directory</cite> is where project/object/binary files that are used for building the project are kept. While it&#8217;s arbitrary, we recommend understandable name e.g. &lt;%WORKSPACE%&gt;/SampleWordLogger/build.</p>
<img alt="_images/logger_cmake_1.png" src="_images/logger_cmake_1.png" />
<p>Then hit <cite>Configure</cite>, so a dialog appears. Choose a type of project you like to make. Let&#8217;s go for <cite>Visual Studio 10</cite> this time(<a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/4625/CMakeGUI1.png">image source</a>)．</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/4625/CMakeGUI1.png" src="http://www.openrtm.org/openrtm/sites/default/files/4625/CMakeGUI1.png" />
<p><cite>Finish</cite> on the dialog window then <cite>Configure</cite> begins. Without an issue you&#8217;ll see &#8220;Configuring done&#8221; in the console on the CMake window, so hit <cite>Generate</cite> button. When you see &#8220;Generating done&#8221;, project/solution file is now ready.</p>
<p>By the way, <cite>CMake</cite> generates cache during <cite>Configure</cite>. Delete them when you re-run <cite>Configure</cite> after making change or stuck at issues, by [File]-[Delete Cache].</p>
<p>In the <cite>build</cite> directory you just specified, open <cite>SampleWordLogger.sln</cite> by double-clicking it, to start <cite>Visual Studio 2010</cite>.</p>
<p>On <cite>Solution Explorer</cite>, right-click <cite>ALL_BUILD</cite> and choose <cite>Build</cite>.</p>
<img alt="_images/vc_logger_built.png" src="_images/vc_logger_built.png" />
<p>Here you can close <cite>VC++ 2010</cite>.</p>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id25">4.4&nbsp;&nbsp;&nbsp;Edit header, source files</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id26">4.4.1&nbsp;&nbsp;&nbsp;Implement Activity</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>SampleWordLogger RTC passes words received via <cite>InPort</cite> and the timestamp recorded at the reception event to file stream.</p>
<p>Actions in <cite>onActivated()</cite>, <cite>onExecute()</cite>, <cite>onDeactivated()</cite> are illustrated (<a class="reference external" href="https://docs.google.com/drawings/d/19KHmLRoOhHJVumNMwcO7CrPV7lWUwmFB3CD5OfT6mIo/edit">you can edit this figure</a> if you with. Ask the edit privilege)．</p>
<img alt="https://docs.google.com/drawings/d/19KHmLRoOhHJVumNMwcO7CrPV7lWUwmFB3CD5OfT6mIo/pub?w=960&amp;amp;h=720" src="https://docs.google.com/drawings/d/19KHmLRoOhHJVumNMwcO7CrPV7lWUwmFB3CD5OfT6mIo/pub?w=960&amp;amp;h=720" />
</div>
<div class="section" id="cpp">
<h3><a class="toc-backref" href="#id27">4.4.2&nbsp;&nbsp;&nbsp;Edit .cpp file</a><a class="headerlink" href="#cpp" title="Permalink to this headline">¶</a></h3>
<p>Write code for <cite>onActivated()</cite>, <cite>onDeactivated()</cite>, <cite>onExecute()</cite> as follows:</p>
<div class="highlight-python"><pre>RTC::ReturnCode_t SampleWordLogger::onActivated(RTC::UniqueId ec_id)
{
  // open file
  std::cerr &lt;&lt; "Opening Log File ... " &lt;&lt; m_SampleWordLoggerFileName &lt;&lt; std::endl;
  std::locale::global(std::locale(""));
  m_SampleWordFileStream.open(m_SampleWordLoggerFileName);
  if(!m_SampleWordFileStream) {
      std::cerr&lt;&lt;"Error opening file"&lt;&lt; std::endl;
      return RTC::RTC_ERROR;
  }

  m_SampleWordFileStream.imbue(std::locale(m_SampleWordFileStream.getloc(),new std::codecvt_utf8_utf16&lt;wchar_t&gt;));

  return RTC::RTC_OK;
}

RTC::ReturnCode_t SampleWordLogger::onDeactivated(RTC::UniqueId ec_id)
{
  // close file
  m_SampleWordFileStream.close();

  return RTC::RTC_OK;
}

RTC::ReturnCode_t SampleWordLogger::onExecute(RTC::UniqueId ec_id)
{
   // Check if the inbound data is new.
   if (m_resultIn.isNew()) {
     // Read in from InPort.
     m_resultIn.read();

     //
     SYSTEMTIME systime;
     GetLocalTime(&amp;systime);
     static char sDate[128];
     sprintf(sDate, "%04d/%02d/%02d %02d:%02d:%02d", systime.wYear, systime.wMonth, systime.wDay, systime.wHour, systime.wMinute, systime.wSecond);
     std::cerr &lt;&lt; "Writing... " &lt;&lt; std::endl;
     std::cerr &lt;&lt; "    " &lt;&lt; sDate &lt;&lt; std::endl;
     m_SampleWordFileStream &lt;&lt; sDate &lt;&lt; " ";

     HRESULT hr = S_OK;
     IXmlReader *pReader = NULL;
     XmlNodeType nodeType;
     IStream *pStream;
     CreateStreamOnHGlobal(NULL, TRUE, &amp;pStream);
     LARGE_INTEGER liBeggining = { 0 };
     pStream-&gt;Seek(liBeggining, STREAM_SEEK_SET, NULL);
     ULONG ulBytesWritten = 0;
     ULONG ulSize = 0;
     ULARGE_INTEGER uliSize = { 0 };
     pStream -&gt; SetSize (uliSize);
     ulSize = (ULONG)strlen(m_result.data);
     pStream-&gt;Write((void const*)m_result.data,(ULONG)ulSize, (ULONG*)&amp;ulBytesWritten);
     pStream-&gt;Seek(liBeggining, STREAM_SEEK_SET, NULL);

     if (FAILED(hr = CreateXmlReader(__uuidof(IXmlReader), (void**) &amp;pReader, NULL)))
     {
        wprintf(L"Error creating xml reader, error is %08.8lx", hr);
            return RTC::RTC_ERROR;
     }

     if (FAILED(hr = pReader-&gt;SetProperty(XmlReaderProperty_DtdProcessing, DtdProcessing_Prohibit)))
     {
        wprintf(L"Error setting XmlReaderProperty_DtdProcessing, error is %08.8lx", hr);
            return RTC::RTC_ERROR;
     }

     if (FAILED(hr = pReader-&gt;SetInput(pStream)))
     {
        wprintf(L"Error setting input for reader, error is %08.8lx", hr);
        return RTC::RTC_ERROR;
     }


     bool firstText = true;
     while (S_OK == (hr = pReader-&gt;Read(&amp;nodeType)))
     {
        LPCWSTR pwszPrefix = NULL;
        UINT cwchPrefix = 0;
        LPCWSTR pwszLocalName = NULL;
        LPCWSTR pwszValue = NULL;

            switch (nodeType)
            {
            case XmlNodeType_Element:
                    if (FAILED(hr = pReader-&gt;GetPrefix(&amp;pwszPrefix, &amp;cwchPrefix)))
                    {
                            wprintf(L"Error getting prefix, error is %08.8lx", hr);
                            return RTC::RTC_ERROR;
                    }
                    if (FAILED(hr = pReader-&gt;GetLocalName(&amp;pwszLocalName, NULL)))
                    {
                             wprintf(L"Error getting local name, error is %08.8lx", hr);
                             return RTC::RTC_ERROR;
                }
                    if (cwchPrefix &gt; 0)
                            wprintf(L"Element: %s:%s\n", pwszPrefix, pwszLocalName);
                    else
                            wprintf(L"Element: %s\n", pwszLocalName);

                    // Attributes
                    const WCHAR* pwszPrefix;
                    const WCHAR* pwszLocalName;
                    const WCHAR* pwszValue;
                    hr = pReader-&gt;MoveToFirstAttribute();
                    while (TRUE)
                    {
                            if (!pReader-&gt;IsDefault())
                            {
                                    UINT cwchPrefix;
                                    if (FAILED(hr = pReader-&gt;GetPrefix(&amp;pwszPrefix, &amp;cwchPrefix)))
                                    {
                                            wprintf(L"Error getting prefix, error is %08.8lx", hr);
                                            return RTC::RTC_ERROR;
                                    }
                                    if (FAILED(hr = pReader-&gt;GetLocalName(&amp;pwszLocalName, NULL)))
                                    {
                                            wprintf(L"Error getting local name, error is %08.8lx", hr);
                                            return RTC::RTC_ERROR;
                                    }
                                    if (FAILED(hr = pReader-&gt;GetValue(&amp;pwszValue, NULL)))
                                    {
                                            wprintf(L"Error getting value, error is %08.8lx", hr);
                                            return RTC::RTC_ERROR;
                                    }
                                    if (cwchPrefix &gt; 0)
                                            wprintf(L"Attr: %s:%s=\"%s\" \n", pwszPrefix, pwszLocalName, pwszValue);
                                    else
                                            wprintf(L"Attr: %s=\"%s\" \n", pwszLocalName, pwszValue);

                                    if ( firstText &amp;&amp; wcscmp(pwszLocalName, L"text") == 0 ) {
                                            m_SampleWordFileStream &lt;&lt; pwszValue &lt;&lt; std::endl;
                                            firstText = false;
                                    }
                                    //m_SampleWordFileStream &lt;&lt; "  " &lt;&lt;  pwszLocalName &lt;&lt; ":" &lt;&lt; pwszValue &lt;&lt; std::endl;
                            }

                            if (S_OK != pReader-&gt;MoveToNextAttribute())
                                    break;
                    }

                    if (pReader-&gt;IsEmptyElement() )
                            wprintf(L" (empty)");
                     break;
             case XmlNodeType_EndElement:
                     if (FAILED(hr = pReader-&gt;GetPrefix(&amp;pwszPrefix, &amp;cwchPrefix)))
                     {
                            wprintf(L"Error getting prefix, error is %08.8lx", hr);
                            return RTC::RTC_ERROR;
                 }
                     if (FAILED(hr = pReader-&gt;GetLocalName(&amp;pwszLocalName, NULL)))
                     {
                            wprintf(L"Error getting local name, error is %08.8lx", hr);
                            return RTC::RTC_ERROR;
                     }
                     if (cwchPrefix &gt; 0)
                            wprintf(L"End Element: %s:%s\n", pwszPrefix, pwszLocalName);
                     else
                            wprintf(L"End Element: %s\n", pwszLocalName);
                     break;
            }
     }
    //
   }
   return RTC::RTC_OK;
}</pre>
</div>
</div>
</div>
<div class="section" id="cmakelist-txt">
<h2><a class="toc-backref" href="#id28">4.5&nbsp;&nbsp;&nbsp;Edit CMakeLists.txt</a><a class="headerlink" href="#cmakelist-txt" title="Permalink to this headline">¶</a></h2>
<p>In this <cite>RTC</cite>, an external library <cite>xmllib</cite> is used to handle log in file (although we&#8217;re not putting the content into <cite>xml</cite> in this sample).Therefore we add it to <cite>CMakeLists.txt</cite>.</p>
<p>Open <cite>SampleWordLogger/CMakeLists.txt</cite> in a text editor (<cite>VC++ 2010, Emacs</cite> etc):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">add_subdirectory</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</pre></div>
</div>
<p>This indicates that definition for <cite>src</cite> directory is delegated to the <cite>CMakeLists.txt</cite> in that directory. So open <cite>SampleWordLogger/src/CMakeLists.txt</cite> and change like:</p>
<div class="highlight-python"><pre>+ # Add xmllibs that's necessary for this SampleWordLogger project
+ set(REQ_LIBS xmllite.dll)

  add_library(${PROJECT_NAME} ${LIB_TYPE} ${comp_srcs}
    ${comp_headers} ${ALL_IDL_SRCS})
  set_target_properties(${PROJECT_NAME} PROPERTIES PREFIX "")
  set_source_files_properties(${ALL_IDL_SRCS} PROPERTIES GENERATED 1)
  add_dependencies(${PROJECT_NAME} ALL_IDL_TGT)
- target_link_libraries(${PROJECT_NAME} ${OPENRTM_LIBRARIES})
+ target_link_libraries(${PROJECT_NAME} ${OPENRTM_LIBRARIES} ${REQ_LIBS})

  add_executable(${PROJECT_NAME}Comp ${standalone_srcs}
    ${comp_srcs} ${comp_headers} ${ALL_IDL_SRCS})
- target_link_libraries(${PROJECT_NAME}Comp ${OPENRTM_LIBRARIES})
+ target_link_libraries(${PROJECT_NAME}Comp ${OPENRTM_LIBRARIES} ${REQ_LIBS})</pre>
</div>
</div>
<div class="section" id="vc">
<h2><a class="toc-backref" href="#id29">4.6&nbsp;&nbsp;&nbsp;Build by VC++</a><a class="headerlink" href="#vc" title="Permalink to this headline">¶</a></h2>
<p>Back to <cite>Visual C++ 2010</cite> (if already closed, open again <cite>SampleWordLogger.sln</cite>). Then build RTC by doing as follows (<a class="reference external" href="http://www.openrtm.org/openrtm/sites/default/files/1028/VC++_build.png">image source</a>)．</p>
<img alt="http://www.openrtm.org/openrtm/sites/default/files/1028/VC++_build.png" src="http://www.openrtm.org/openrtm/sites/default/files/1028/VC++_build.png" />
<p>If you don&#8217;t see any error on <cite>Visual C++ 2010</cite> console, you&#8217;re done finally!</p>
</div>
</div>
<div class="section" id="id8">
<h1><a class="toc-backref" href="#id30">5&nbsp;&nbsp;&nbsp;HowToRun</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h1>
<p>Your current directory is assumed to be the home of the USB unless specified.</p>
<p>Let&#8217;s run/play the game! <cite>SampleWordLogger</cite> by itself doesn&#8217;t do anything. Run together <cite>MotionByVoiceDemo</cite> that we saw earlier to record what you say.</p>
<p><cite>.bat</cite> files to call involved RTCs are already made for you in <cite>./demo/MotionByVoiceLoggerDemo</cite>.</p>
<p>MotionByVoiceLoggerDemo</p>
<ol class="arabic simple">
<li>From <cite>./demo/MotionByVoiceLoggerDemo</cite>, run &#8220;0_StartDemo.bat&#8221;，&#8221;1_ConnectRTC.bat&#8221;，&#8221;2_ActivateRTC.bat&#8221;, respectively by clicking the link below. If it doesn&#8217;t work then do so from  <cite>Explorer</cite>.</li>
</ol>
<ul>
<li><a class="reference external"  href="javascript:void(0)" onclick="callbat_relativepath('MotionByVoiceLoggerDemo\\0_StartDemo.bat'); return false;">./demo/MotionByVoiceLoggerDemo/0_StartDemo.bat</a> | </li>
<li><a class="reference external"  href="javascript:void(0)" onclick="callbat_relativepath('MotionByVoiceLoggerDemo\\1_ConnectRTC.bat'); return false;">./demo/MotionByVoiceLoggerDemo/1_ConnectRTC.bat</a> | </li>
<li><a class="reference external"  href="javascript:void(0)" onclick="callbat_relativepath('MotionByVoiceLoggerDemo\\2_ActivateRTC.bat'); return false;">./demo/MotionByVoiceLoggerDemo/2_ActivateRTC.bat</a></li>
</ul><a class="reference external"  href="javascript:void(0)" onclick="call_rtseditor(); return false;">./demo/RTSE.bat</a> で見てみると，`SampleWordLogger` の RTC も実行されているのが確認可能．<img alt="_images/rtse_motionvoicelogger_activated.png" src="_images/rtse_motionvoicelogger_activated.png" />
<ol class="arabic simple" start="2">
<li>Run demo as the same you did in <a class="reference external" href="1.4_callmotion_byvoice.html#HowToRun">MotionByVoiceDemo tutorial</a></li>
<li>Click &#8220;3_DeactivateRTC.bat&#8221;, &#8220;4_DisconnectRTC.bat&#8221;，&#8221;5_DemoExit.bat&#8221;, respectively.</li>
</ol>
<ul>
<li><a class="reference external"  href="javascript:void(0)" onclick="callbat_relativepath('MotionByVoiceLoggerDemo\\3_DeactivateRTC.bat'); return false;">./demo/MotionByVoiceLoggerDemo/3_DeactivateRTC.bat</a> | </li>
<li><a class="reference external"  href="javascript:void(0)" onclick="callbat_relativepath('MotionByVoiceLoggerDemo\\4_DisconnectRTC.bat'); return false;">./demo/MotionByVoiceLoggerDemo/4_DisconnectRTC.bat</a> | </li>
<li><a class="reference external"  href="javascript:void(0)" onclick="callbat_relativepath('MotionByVoiceLoggerDemo\\5_DemoExit.bat'); return false;">./demo/MotionByVoiceLoggerDemo/5_DemoExit.bat</a></li>
</ul><ol class="arabic" start="4">
<li><p class="first">You&#8217;ll see the timestamp and the word spoken in <cite>./demo/SampleWordLogger/build/Debug/SampleWord.log</cite>.</p>
<blockquote>
<div><p>2014/03/13 08:56:31 左 さげて
2014/03/13 08:56:44 右 あげて
2014/03/13 08:57:08 左 よろしく
2014/03/13 08:58:23 左 あげて
2014/03/13 08:58:39 左 あげない</p>
</div></blockquote>
</li>
</ol>
<hr class="docutils" />
<p>Go back to <a class="reference external" href="index.html">index</a> | Go to <a class="reference external" href="2.2_samplemotionselector.html">next</a></p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="top.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1&nbsp;&nbsp;&nbsp;Introduction</a><ul>
<li><a class="reference internal" href="#id1">1.1&nbsp;&nbsp;&nbsp;What you&#8217;ll experience</a></li>
<li><a class="reference internal" href="#id2">1.2&nbsp;&nbsp;&nbsp;Related Tutorials</a></li>
<li><a class="reference internal" href="#systemenvironment">1.3&nbsp;&nbsp;&nbsp;SystemEnvironment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rtc-i-o-configuration">2&nbsp;&nbsp;&nbsp;RTC spec (I/O, Configuration)</a></li>
<li><a class="reference internal" href="#rtcbuilder">3&nbsp;&nbsp;&nbsp;Install RTCBuilder</a></li>
<li><a class="reference internal" href="#how-to-make-rtc">4&nbsp;&nbsp;&nbsp;How to make RTC</a><ul>
<li><a class="reference internal" href="#id3">4.1&nbsp;&nbsp;&nbsp;Create New Project</a></li>
<li><a class="reference internal" href="#samplewordlogger">4.2&nbsp;&nbsp;&nbsp;Generate SampleWordLogger RTC template</a><ul>
<li><a class="reference internal" href="#id4">4.2.1&nbsp;&nbsp;&nbsp;Input profile info and generate code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">4.3&nbsp;&nbsp;&nbsp;Build tentatively</a></li>
<li><a class="reference internal" href="#id6">4.4&nbsp;&nbsp;&nbsp;Edit header, source files</a><ul>
<li><a class="reference internal" href="#id7">4.4.1&nbsp;&nbsp;&nbsp;Implement Activity</a></li>
<li><a class="reference internal" href="#cpp">4.4.2&nbsp;&nbsp;&nbsp;Edit .cpp file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cmakelist-txt">4.5&nbsp;&nbsp;&nbsp;Edit CMakeLists.txt</a></li>
<li><a class="reference internal" href="#vc">4.6&nbsp;&nbsp;&nbsp;Build by VC++</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">5&nbsp;&nbsp;&nbsp;HowToRun</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/2.1_samplewordlogger.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="top.html">openrtm_tutorial 0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, NEDO, TORK.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>